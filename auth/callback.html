<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>Microsoft OAuth å›è°ƒ</title>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const params = new URLSearchParams(window.location.search);
      const code = params.get("code");

      if (!code) {
        document.body.innerHTML = "<h2>âŒ æœªæ£€æµ‹åˆ°æˆæƒç </h2>";
        return;
      }

      try {
        if (window.opener && !window.opener.closed) {
          console.log("ğŸ“¡ å‘æ’ä»¶å‘é€æˆæƒç ...");
          window.opener.postMessage({ type: "oauth_code", code }, "*");
          document.body.innerHTML = "<h2>âœ… æˆæƒæˆåŠŸï¼æ­£åœ¨é€šçŸ¥æ’ä»¶...</h2>";
          setTimeout(() => { try { window.close(); } catch {} }, 1000);
          return;
        }
      } catch (e) {
        console.warn("âš ï¸ postMessage é€šä¿¡å¤±è´¥:", e);
      }

      document.body.innerHTML = `
        <h2>æˆæƒæˆåŠŸï¼</h2>
        <p>æœªæ£€æµ‹åˆ°æ’ä»¶çª—å£ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶æˆæƒç ï¼š</p>
        <pre>${code}</pre>
      `;
    });
  </script>
</head>
<body>
  <h2>æ­£åœ¨å¤„ç†æˆæƒç»“æœ...</h2>
</body>
</html>
